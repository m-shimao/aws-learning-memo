# サービス一覧

知らなかったこと・重要そうなこと・忘れそうなことを中心にメモしていく

## Amazon EC2 Container Registry

## VM Import
- 既存のVMイメージをデータセンターからAmazon EC2に移行できる
- VMイメージのディザスタリカバリとして使える

## VM Export
- VM ImportしたインスタンスをAWS外にエクスポートするためのコマンド
- EC2上で作成したインスタンスはExport不可

## Elastic Load Balancing（ELB）
- Classic Load Balancer（CLB）とALBを含んだ総称
    - CLBは旧ELBのこと
- スケーラブル(負荷分散)かつ高可用性のサービスの提供が可能になる
    - ELBがスケールするときには、IPアドレスが変化するので必ずDNS名でアクセスすること
- ELB自体がスケーラブル、従量課金
- ヘルスチェック(ping等)を行ってくれる
- 独自ドメイン名
    - Route 53を使用する場合は、Route 53エイリアスレコード(Zone ApexでなければCNAMEも可)
- クライアントのIPアドレスはHTTPヘッダ上のX-Forwarded-Forで参照可
- 急激なELBへの負荷が予想される場合は、Pre-Warming（暖機運転）の申請を行う
- Internet-Facing ELB
    - インターネットからアクセスできるELB
- Internal ELB
    - VPC内やオンプレミス環境からのみアクセスできればよいELB
- スティッキー セッション
    - 同じユーザから来たリクエストを全て同じEC2インスタンスに送信
    - EC2にセッション情報等を保持する場合に使用（DB等に持たせるほうが望ましい）
- Connection Draining
    - 登録解除やヘルスチェックがFailしたEC2への割り振りを中止するが、処理中リクエストは終わるように一定時間待つ機能
- WebSocketとLB
    - セッション確立時だけLBを使うのが上手な付き合い方

### Application Load Balancer (ALB)
- レイヤー７のコンテントベースのロードバランサー
- コンテントベースのルーティングとは(http://itpro.nikkeibp.co.jp/atcl/column/16/121200298/121200001/?rt=nocnt)
    - 例えば「http://xxxx.yyyy.co.jp/AAA/」というリクエストはAサーバーに、「http://xxxx.yyyy.co.jp/BBB/」というリクエストはBサーバーに振り分けれる
    - 単一のロードバランサーで異なるアプリケーションへリクエストをルーティング可能
- 複数ポート対応と動的ポートマッピングによって、ECSと組み合わせることが可能
- 特徴は以下
    - コンテナベースアプリケーション・WebSocket・HTTP/2のサポート、複数AZ対応のため高耐障害性、ALB自体が自動スケールする
- 料金は利用時間とLoad Balancer Capacity Units（LCU）で計算
    - LCUは新規接続数・アクティブ接続数・帯域幅の内で最も高いディメンションでのみ請求する仕組み

### Classic Load Balancer（CLB）
- TCP/SSL（セキュアTCP）による負荷分散も可能
- バックエンドインスタンスは、全て同一の機能を持ったインスタンスが必要、異なる機能に対してコンテントベースルーティングは出来ない

## Auto Scaling
- 必要な分だけのサーバリソースを確保し、高い可用性とコスト最適化を実現する

### Auto Scaling Group(ASG)
- 情報管理単位。最小/最大台数等を設定する

### Launch Configuration
- 起動するEC2インスタンスの情報。通常のEC2インスタンスを起動する際の入力情報とほぼ同じ

### Scaling Plan
- どのようにスケールするかを定義する。1つのASGに複数のPlanを設定可能

###  動的スケーリングのスケーリング調整タイプ
- ChangeInCapacity
    - 指定した数だけASGの現在の容量を増減
- ExactCapacity
    - 指定した数にASGの現在の容量を変更
- PercentChangeInCapacity
    - 指定した%分だけASGの現在の容量を増減

### Application Auto Scaling
- Auto Scalingと似たUXでAWSリソースの自動スケールを実現
- サポートサービスはECS,SpotFleet,EMR

### その他
- Scale Out
    - EC2インスタンスを増やすこと
- Scale In
    - EC2インスタンスを減らすこと
- クールダウン
    - インスタンス初期化中の無駄なスケーリングを回避するために利用
- ターミネーションポリシー
    - OldestInstance/NewestInstance, OldestLaunchConfiguration, ClosestToNextInstanceHour
    - デフォルトはOldestLaunchConfiguration -> ClosestToNextInstanceHourの順に適用し、複数の場合はランダム
- インスタンス保護
    - Scale Inの対象から除外する用に指定可能
- スケールアウト時の初期化処理をどうするか
    - 設定済みのAMI（ゴールデンイメージ）を用いる
    - user-dataで初期化スクリプトを実行
    - Life Cycle Hooksを利用して初期化する
- Auto Scalingは突発的なスパイクには向いていない
- スパイクに対応するには、CF等の利用・スロットリング機能の設置・一定以上を超えた場合の静的ページへの切替を検討する

##  EC2 Container Service

### Container技術について
- 4つのキーワード。OS仮想化、プロセス隔離、イメージ、自動化
- コンテナは、リソース隔離が元々の由来

#### The Twelve-Factor App
- ベストプラクティスの1つ。アプリをコンテナに対応させる。
    - コードベース: バージョン管理される1つのコードベースと複数デプロイ
    - 依存関係: 依存関係を明示的に宣言し分離する
    - 設定: 設定を環境変数に格納する
    - バックエンドサービス: バックエンドサービスをアタッチされたリソースとして扱う
    - ビルド、リリース、実行: ビルド、リリース、実行の3つのステージを厳密に分離する
    - プロセス: アプリを1つ又は複数のステートレスなプロセスとして実行
    - ポートバインディング: ポートバインディングを通してサービスを公開する
    - 並行性: プロセスモデルによってスケールアウトする
    - 廃棄容易性: 高速な起動とグレースフル停止で堅牢性を最大化する
    - 開発/本番一致: 開発、ステージング、本番環境をできるだけ一致させた状態を保つ
    - ログ: ログをイベントストリームとして扱う
    - 管理プロセス: 管理タスクを1回限りのプロセスとして実行する
    
### Amazon EC2 Container Serviceについて
- コンテナ管理をあらゆるスケールで
- 柔軟なコンテナの配置
- AWSの基盤との連携
- Task: Instance上で実行されている実際のContainer
- Task Definition: Taskで使うContainer、及び周辺設定の定義
- Cluster: Taskが実行されるEC2Instance群
- Manager: ClusterのリソースとTaskの状態を管理
- Scheduler: Clusterの状態をみて、Taskを配置
- Agent: EC2 InstanceとManagerの連携を司る

#### Service
- ロングランニングアプリケーションを希望する状態に保ち続ける
- ALBとの動的ポートマッピング
- Application Auto ScalingのAmazon ECS Serviceサポート

#### Security
- 各TaskにIAMロールを指定することができる
    - 同一のContainer Instance上で異なるIAMロールのTaskが動く
    - Container InstanceのIAMロールは必要最低限にできる

#### Simple
- マスターサーバ群が不要。クラスタ管理ソフト自体を管理する必要がなくなる
- AWS SDK/CLI/CloudFormationで期待通りの動作
- AWSとネイティブな連携

## AWS Elastic Beanstalk(ビーンストーク)
- 定番構成の構築・アプリデプロイの自動化サービス
- アプリケーション
    - トップレベルの論理単位。バージョン、環境、環境設定が含まれている入れ物
- バージョン(Application Version)
    - デプロイ可能なコード。Amazon S3 上でのバージョン管理
- EB Command Line Interface(EB CLI) 
    - ハイレベルな操作が可能なコマンドラインツール
- デプロイメントに関する用語(EBではどちらも可能)
    - In Place Deployment(Rolling Deploy)
        - インスタンスは現行環境のものをそのまま利用し、新しいリビジョンのコードをその場で反映させる
    - Blue/Green Deployment(Red/Black Deployment)
        - 新しいリビジョンのコードを、新しいインスタンスに反映させ、インスタンスごと入れ替える
- デプロイに関する設定
    - バッチタイプ: 一度にデプロイを反映させる台数(バッチ)をどう決めるかを設定
    - バッチサイズ: 各バッチにデプロイするインスタンスの数または割合

## AWS Lambda
- クラウドネイティブとは
    - クラウドで提供されるサービス利用を前提に構築するシステムおよびアプリケーション
    - 仮想サーバ上で1から全てを作り込むのではなく効率的にアプリケーションを実装
    - ビジネスの差別化ポイントへの集中
- インフラを一切気にすることなくアプリケーションコードを実行できるコンピュートサービス
- やりたいこと・ビジネスロジックだけに集中できる
- ファンクション
    - それぞれが隔離されたコンテナ内で実行される
- イベントソース
    - イベントの発生元となるAWSリソース
        - Amazon S3
        – Amazon Kinesis
        – Amazon DynamoDB Streams
        – Amazon Cognito(Sync)
        – Amazon SNS
        – Alexa Skills Kit
        – Amazon SWF
    - Pushモデル(S3, Cognito, SNS)
        - 順不同
        - 3回までリトライ
    - Pull(DynamoDB, Kinesis)
        - 順序性あり。ストリームに入ってきた順に処理される
        - イベントごとに複数のレコードを取得可能
        - データが期限切れになるまでリトライ
- パーミッションモデル
    - ExecutionパーミッションとInvocationパーミッションの2種類
    - ExecutionRole
        - 必要なAWSリソースへのアクセスを許可するIAMロール
- クロスアカウントアクセス
    - 異なるAWSアカウントのアプリケーションからのアクセスが可能
- Blueprint
    - Lambdaファンクションの新規作成時に利用可能なサンプル集
- スケジュール実行
    - CloudWatch Events – Scheduleを使用する
    - Cron形式の指定もサポート
- VPC内のリソースへインターネットを経由せずにアクセス可能
    - Elasticache, RDS, EC2 ...
    - Elastic Network Interface(ENI)を利用
    - ENIには指定したサブネットのIPがDHCPで動的に割り当てられる

### 特徴
- インフラの管理が不要
- オートスケール
- Bring your own code
- 細やかな料金体系
    - アイドル時の支払いは一切なし

### ユースケース
- 監査と通知
    - ex.S3に保管されるCloudTrailのログを分析し、怪しい行動や異常を検知したら通知する
- 写真共有モバイルアプリ
- モーションセンサーを利用した観客参加型ゲーム
- APIサーバの代わりとして

### Lambdaファンクション作成時の注意事項
- ロールを正しくセットアップする
- 再帰処理は慎重に
    - 無限ループに陥る可能性があるので

## AWS Batch
- フルマネージド型のバッチ処理実行サービス
- ジョブとして登録したアプリケーションやコンテナイメージをスケジューラが実行
- AWS Batchの利用料金は無料(起動したリソースについて課金される)
- システム利用者が使用するジョブ管理システム
    - システム管理者が使用するジョブ管理システムのほうではない
    - AWS Batchは負荷の高いコンピューティングを効率的に行うためのサービス

### バッチジョブスケジューラの役割り
- ユーザが投入したジョブを待ち行列に貯める。(queueing)
- 空いているコンピュータにジョブを割り当てて処理させる。(dispatch)
- 空いているコンピュータが無い時は、ジョブを待ち行列で待機させ、コンピュータが空いた時点でdispatchし、処理を開始させる。
    
### Jobs (ジョブ)
- EC2上で動作するコンテナ化されたアプリケーションとしてAWS Batchによって実行される作業単位。

### Job Definitions (ジョブ定義)
- ジョブの雛形となるテンプレートのようなもので、ジョブの実行方法を定義する
- ジョブに関連付けるIAMロール
    - コンテナイメージ
    - 実行するコマンド
    - vCPUとメモリ要件
    - ボリュームとマウントポイント
    - 環境変数

### Job Queues (ジョブキュー)
- 投入されたジョブの待ち行列となる場所

### Compute Environments (コンピュート環境)
- jobが実行されるコンピューティング環境。

## AWSの移行(Migration)
- マイグレーションとは、現行システムと将来システムのギャップを埋める計画や対応作業

### AWS Cloud Adaption Framework(CAF)
- クラウドコンピューティングに対する包括的アプローチを活用した効率的な移行
- 組織が効果的なクラウド導入を進めるにあたって、組織が持つスキルとプロセスにどのような変革が必要かを示唆するもの

### AWS Application Discovery Service
- ADSが必要とされる背景
    - クラウドへ何を移行するのか？の把握が必要
    - 既存システムの情報が整理・更新されていない現状（可視化が不十分）
    - ツールによる効率的な既存システム情報の収集

### AWS Server Migration Service
- SMSが必要とされる背
    - クラウド最適化移行はハードルが高い
    - 現状多いリホスト移行
    - 簡単に大量のサーバーをAWSへ移行したい要望

## EBS
- EC2インスタンスにアタッチして使用するブロックレベルのストレージサービス
- 99.999%の可用性

### 特徴
- 最大容量は16TB
- AZ毎に独立しているため、同一AZのインスタンスからのみ利用可能
- Snapshotから任意のAZに復元できる
- EC2に複数のEBSを接続することはできるが、EBSを複数のEC2で共有することはできない

### 基本的なアーキテクチャ
- データはAZ内で複数のHWにレプリケートされており、一般的にはさらなる冗長化は不要
- 実体はネットワーク接続型ストレージだが、ユーザはネットワークを意識する必要はない
- セキュリティグループによる通信制御の対象外。全ポートを閉じてもEBSは利用できる

### ボリュームタイプ
- 汎用SSD(General Purpose(SSD))
– プロビジョンドIOPS(SSD)
– スループット最適化HDD
– コールドHDD
– マグネティック(Magnetic)
- Snapshotを経由することでボリュームタイプや容量を変更可能

### インスタンスストア
- 追加コスト無しの揮発性のインスタンスストア
- 実体はEC2の物理ホストのローカルディスク
- 一時的なデータの置き場所や、分散ファイルシステムのストレージとして活用する

### 事前ウォーミング(Pre-Warming)
- Snapshotから復元したボリュームに限り、各ブロックへの初回アクセス時、IOPSに5%から50%のペナルティが発生する
- 全領域からの読み込み処理の実行による事前ウォーミング(PreWarming)を行うことで、
Snapshotから復元したボリュームに対する初回アクセス時のペナルティを回避できる

### Snapshot
- バックアップ機能。リストア時は新しいボリュームを作成する形となる
- 2世代目以降は差分データを保存する差分バックアップとなる（1世代目を削除しても復元は可能）
- Snapshot作成時はデータ整合性を保つため静止点を設ける事を推奨
- EBSを別AZに移動したい場合や、容量変更、ボリュームタイプ変更もSnapshot経由で行う

### データボリュームの暗号化
- EBSボリュームの作成時に暗号化を指定すると、AES-256による暗号化処理が行われる
- ボリュームの利用方法は従来通り。暗号化が有効であったとしても、特に意識する必要はない。Snapshotも暗号化される
- 暗号化/復号化の処理はハードウェア機能を使って実施するため、パフォーマンスへの影響は極めて小さい
- 起動ボリュームの暗号化
    - 起動ボリュームの暗号化もサポート。ただし暗号化を有効にする手順が異なりAMIのコピー機能を利用する

### What’s new
- 起動ボリュームの暗号化をサポート
- スループット最適化HDD (st1)とコールドHDD (sc1)の追加
    - シーケンシャルアクセスに最適化
    - DWHやETL, ログ分析等ビッグデータのワークロードでの利用に最適
    - IOPSではなくスループットで性能上限を規定、バースト可能
    - EBS最安のボリュームタイプ

## Amazon S3
- オブジェクトストレージ
    - 安価かつ高い耐久性を持つオンラインストレージサービス
    - オブジェクト、それに付随するメタデータ、そのオブジェクトにアクセスするためのユニークなIDで構成されるデータの倉庫
- ユーザはデータを安全に、どこからでも、容量制限なく保存可能

### 特徴
- 容量無制限(1ファイル5TBまで)
- 高い耐久性(99.999999999%)
- 安価なストレージ(月額1GB/約3円)
- スケーラブルで安定した性能

### 用途
- コンテンツ配信や保管サーバ
- ログ＆データハブストレージ
- バックアップやディザスタリカバリ

### Data Consistency モデル
– Amazon S3はデータを複数の場所に複製することで高い可用性を実現するため、
データの更新・削除にはEventual Consistency Readモデル（結果整合性）が採用されている
- 新規登録 (New PUTs)
    - 登録後、即時データが参照できる
- 更新 (Overwrite PUTs) 
    - 更新直後は、以前のデータが参照される可能性がある
- 削除 (DELETE)
    - 削除直後は、削除前のデータが参照される可能性がある

### アクセス管理
- ユーザポリシー
    - IAM Userに対して、S3やバケットへのアクセス権限を設定
    - 複数バケットやS3以外のものも含めて一元的にユーザ権限を指定する場合など
- バケットポリシー
    - S3バケット毎に、アクセス権限を指定
    - クロスアカウントでのS3バケットアクセス権を付与する場合など
- ACL
    - 各バケットおよびオブジェクトのアクセス権限を指定
    - バケット単位やオブジェクト単位で簡易的に権限を付与する場合など
    - バケットACLはオブジェクトにも影響を与えるが、オブジェクトが個別にACLを設定している場合は優先される
    - ACLよりも、ユーザポリシーやバケットポリシーが優先される

### 暗号化によるデータ保護
 - サーバサイド暗号化
 - クライアントサイド暗号化

### クロスリージョンレプリケーション
- 異なるリージョン間のS3バケットオブジェクトのレプリケーション

### Amazon CloudWatchによるメトリクス管理
- バケットに対するストレージメトリクス -> 日単位
- オブジェクトに対するリクエストメトリクス -> 分単位

### パフォーマンス最適化
- Multipart Upload
    - ファイルが100MBを超える場合、利用することを推奨
- 1 秒あたり 100 個以上のリクエストを定常的に処理している場合
    - キー名先頭部分の文字列をランダムにすることを推奨
- Amazon S3 Transfer Acceleration

## Amazon CloudFront
- Distribution: ドメイン毎に割り当てられる CloudFront の設定
- Web もしくは RTMP(Real Time Messaging Protocol) Distribution を選択可能
- HTTP/1.0, HTTP/1.1, HTTP/2 対応
- オリジンへのアクセス: Range GET対応
- エッジでの Gzip 圧縮機能
- キャッシュの Invalidation(無効化)
    - コンテンツ毎の無効化パス指定
    - 同時に最大 3,000 個までのパス指定が可能
    - ワイルドカードを利用した無効化パス指定
    - 同時に最大 15 個まで無効化パスリクエストが指定可能。オブジェクト数の制限無し

- 動的コンテンツキャッシュへの対応
    - オリジンサーバに対して Header, Cookie, Query Strings 情報を フォワードすることで、動的なページの配信にも対応

### AWS Lambda@Edge
- Lambda@Edge は AWS Lambda の拡張、AWS の エッジロケーションでのコード実行を可能に
- コードをエッジロケーションに配置することで、エンド ユーザーの近くでコンテンツをカスタマイズし、ユー ザー体験を改善

## Amazon Glacier
- アーカイブやバックアップのため、セキュアかつ堅牢性 の高い超低価格ストレージサービスの提供
- 既存でテープ媒体などでバックアップを取得しているような大容量データを、安価で確実に長期保存する仕 組みを提供
- データの取り出し回数は少ないが、必要な時に確実に データの取り出しが行えるサービスの提供
- 自動サーバサイド暗号化(AES256)

### AWS Import/Export
- ポータブルストレージデバイスを送付することで、大量のデータの転送を高速化します。
- AWS は、Amazon の高速な内部ネットワークを使用してお客様のストレージデバイスとの間で直接データを転送します。

## Amazon Elastic File System
- 複数のEC2からNFS(Network File System)を使って ネットワーク経由でアクセス
- EFSへのアクセスはファイル単位
    - EBSはブロック単位
- PCから使用できるファイル共有サービスではない
- 現時点では東京リージョン未対応
- アジアパシフィック (シドニー) 0.36 USD/GB-月
- 幅広いユースケース
    - パッケージアプリでS3に対応 させるなどの修正できない
    - ビックデータ/HPC
    - 大量のサーバに分散して分析 する際に分析データの共有コンテンツのレポジトリ
- Windowsはサポートしておらず、利用不可

### シンプル
- フルマネージド型
    - サーバ、ディスクなどの管理は不要
- 既存のツールやアプリがそのまま使える
    - NFS v4でマウントできる
- 保存された合計容量だけの課金

### 柔軟・スケーラブル
- 拡張・縮小などは不要
    - 1つのファイルシステムにペタバイトまで保存可能
- 性能がスケール
- 数千のNFS同時接続をサポート

### 高耐久性・高可用性
- 複数AZに複製されて保存される
- 複数のAZから同時に読み書き可

## AWS Storage Gateway
- 標準的なストレージプロトコルを利用してAWSのストレージサービスへの アクセスを可能にするハイブリッドストレージソリューション
- データ保管先に、安価かつ耐久性の高いAmazon S3 およびAmazon Glacierを使用

### 利点
- 標準的なストレージプロトコルを活用したシームレスなインテグレーション
- キャッシュを活用した低レイテンシなアクセス
- AWSストレージサービスの、堅牢性、コスト、拡張性
- 効率的なデータ転送
- データの暗号化

### 活用領域
- クラウドワークロードの活用
    - ビッグデータ処理、クラウドバースティング、移行のためにデータをAWS ストレージに移動
- バックアップ、アーカイブ、災害対策
    - コスト効果の高いAWSのストレージにバックアップ、ローカルまたはクラウド上へリストア
- 階層化クラウドストレージ
    - オンプレミス環境で容易にAWSストレージを活用
  
### ファイルゲートウェイ
- オンプレ・仮想サーバ上のファイルデータをAWS Storage Gateway経由でS3上のオブジェクトとして格納
- ファイルとオブジェクトのマッピングは1対1
- VMware環境上およびEC2上での稼働サポート
− NFSロックは利用できない
    - バックエンドのS3はEventualConsistency
    - 整合性が取れないため、同一ファイルへの複数のクライアントからのアクセスは非推奨

### ボリュームゲートウェイ
- オンプレミス環境のディスクデータをAWS Storage Gateway経由でSnapshotとしてAmazon S3上に取得し、 AWS環境でのDisaster Recoveryを実現

### テープゲートウェイ
- 物理テープライブラリ装置の代替として、Storage Gateway を仮想テープライブラリとして利用することで、
堅牢性の高い外部保管バックアップストレージを実現

## AWS Snowball
- 「ハードウェアアプライアンス」を利用してオンプレミ ス−クラウド間の大量データ移行を高速化
    - 50TB(US only)/80TBの容量をもつ物理アプライアンスを配送
    – オンプレミス−クラウド間の回線に依存しないデータ転送を実現
- S3へのデータアップロードは1日−2.5日程度で完了
- 運搬も含めて10日程度でデータ移行完了
- $250.00(80TBアプライアンス)
- データ転送ジョブをサブミットする前にオンプ レミス環境でクライアントをテストする

## Amazon ElastiCache
- AWS クラウドでの分散インメモリキャッシュ環境のセットアップ、管理、およびスケーリング、冗⻑構成等をを容易に構築することができるサービス
- 構築
    – キャッシュクラスタを数クリックで起動
    – 初期費⽤無し、時間単位の従量課⾦
- 親和性
    – 2種類のエンジン(memcached, redis)をサポート
    – 既存アプリケーションの変更不要
- 運⽤
    – 可⽤性を向上させる機能
    – モニタリング、⾃動障害検出、復旧、拡張、
    - パッチ適⽤、バックアップが容易
- セキュリティ
    – セキュリティグループ、VPC対応
- Consistent Hashing
    - キャッシュクラスタのスケールアウトに適したデータの保持アルゴリズム

### Amazon ElastiCache for memcached
- バックアップ機能(Snapshot)は持たない
- Auto Discovery ⽤に対応した専⽤のライブラリをAWSから提供
    - オートディスカバリとは、複数のキャッシュノードのそれぞれのエンドポイントを意識せず使うための機能

### Amazon Redis
- Amazonが独⾃拡張したRedis
    - バックアップの改善、レプリケーションの効率化、Swapの効率化

## AWS CloudFormation
- Infrastructure-as-code
- EC2やELBといったAWSリソースの環境構築を、設定ファイル（テンプレート）を元に自動化できるサービス
- AWS CloudFormationの利用自体は無料

### スタック
- テンプレートからプロビジョニングされるリソースの集合のことをスタックと呼ぶ
- 使用するリソースおよびリソースの構築順は、テンプレートの依存関係からCloudFormationが自動的に決定
- CloudFormer
   - 構築済みの環境からテンプレートを作成するツール（Webアプリ）
- AWS CloudFormation Degsignerで、ドラッグアンドドロップインターフェイスを使用して、テンプレートを図として視覚化し、編集することも可能

## AWS CloudTrail
- AWSユーザの操作(API)をロギングするサービス
- CloudTrail 自体は無料

### CloudTrailログファイルの活用方法
- 短期的視点:アラート
- 中期的視点:文字列検索
- 長期的視点:可視化

## AWS Config
- AWSリソースのレポジトリ情報から、リソースの変更履歴、構成変更を管理するサービス
- AWS Config Rulesによるポリシー適合の評価
    - 準拠すべきルールを事前に設定し、その内容に沿った構成変更が行われているかを評価
        - 全てのEBCボリュームが暗号化されているか
        - EC2インスタンスが適切にタグ付されているか等

## Amazon EMR

### 分散処理基盤
- Master Node
    - いわゆるマスターの役割を担う 
        - – Core NodeやTaskNodeの監視
- Core Node
    - いわゆるスレーブの役割を担う
        - DataNodeが動きローカルディスクがHDFSとして使われる
- Task Node
    - HDFS(Hadoop Distributed File Systemの略で、Hadoop上で利用される分散ファイルシステム)を持たない以外はCoreと同じ役割
    - HDFSのデータはCore Nodeにアクセスする
    - HDFSを持たないので削除もより自由
- EMRFS: Amazon S3をHDFSの様に扱う

## AWS Data Pipeline
- さまざまなサーバーやデータベースからのデータの回収
- ETL(Extract/Transform/Load)
- Redshiftへのデータロード
- データ利用の前の前処理
- サービス間のデータ統合・処理をスケジュールベースで自動化してくれるサービス
- AWS Data Pipelineはスケジュールベースのサービス
    - イベントドリブンな処理を行いたければAWSLambdaを使う

## Amazon Elasticsearch Service
- 全文検索(Full-Text Search)
    - コンピュータにおいて、複数の文書（ファイル）から特定の文字列を検索すること
- 転置インデックス
    - キーワードがどの文書に存在するかを索引付け
- Elasticsearchのマネージドサービス
    – AWSクラウド上で Elasticsearch を簡単に構築可能

## Amazon Kinesis
- ストリーミングデータを収集・処理・配信するためのマネージドサービス群

### Amazon Kinesis Streams
- ストリーミングデータを処理・分析するためのアプリケーションを独⾃に構築

### Amazon Kinesis Firehose
- ストリーミングデータをAmazon S3, AmazonRedshift, Amazon ES へ簡単にロード

### Amazon KinesisAnalytics
- ストリーミングデータを標準的な SQL クエリーで簡単に分析

## AWS Key Management Service
- 暗号鍵の作成、管理、運⽤サービス
    - 可⽤性、物理的セキュリティ、ハードウェアの管理をAWS が担当するマネージドサービス
    - 暗号化キーを保存および使⽤するための安全なロケーションを提供
        - 暗号鍵の可⽤性、機密性を確保
- 保管データの暗号化(Data Encryption at rest)
- 暗号化の鍵管理において考慮すべき問題
    - 鍵はどこに保管されるのか？
    - 鍵はどこで使われるのか？
    - 誰が鍵を使えるのか？
- Envelope Encryption
    - マスターキーをデータ暗号化に直接利⽤するのではなく暗号化に利⽤するためのデータキーを暗号化/復号に利⽤
- HSA
    - 鍵の⽣成、利⽤、データの暗号化/復号に関わる暗号化機能提供
- 対称鍵暗号⽅式のみサポート
- KMSの統制は第三者認証を取得している:
    - Service Organization Control (SOC 1)
    - PCI-DSS

## Amazon SES
- コスト効率に優れたEメールサービス
- SESによるメール送信には以下2パターンの方法がある
    – HTTP REST APIを使用する方法
    – SMTPエンドポイントを使用する方法
        - デフォルトではEC2から外向きTCP 25番ポートは制限対象
- 現状日本国内の携帯キャリアの制限を十分考慮した配信アルゴリズムになっていない

## Amazon Simple Queue Service(SQS)
- AWSフルマネージドな分散キュー
- 高い信頼性： 複数のサーバー/データセンターにメッセージを保持
- スケーラブル： 多数の送信者/受信者に対応
- 高スループット： メッセージが増加しても高スループットを出し続ける
- 低コスト： 毎月の無料枠 + 使った分だけの従量課金
- SQSを使う利点: 疎結合 – Loosely Coupled

## Amazon Simple Notification Service(SNS)
- マルチプロトコルに対応したフルマネージド通知サービス

## Amazon SWF
-「処理のステート管理」と「タスク間のコーディネート」を行うためのフルマネージドサービス
- ワークフロースターター
    - ワークフローをキックするプログラム
- ワークフローエグゼキューション
    - ワークフローのインスタンス
- ドメイン
    - プログラム言語でいう「ネームスペース」のような概念
- タスクリスト
    - デサイダー/アクティビティがポーリングをするためのキュー
- Amazon SWFは、デサイダーとアクティビティのコーディネートと、ステート管理を行うサービス

### AWS Flow Framework
- ワークフロー開始の呼び出し、タスクリストのポーリング、分岐処理の実行など、SWFの各種APIを隠ぺいしてハイレベルなプログラミングを提供する、クライアントフレームワーク
- Flow Frameworkを利用することで、最小/平易な実装で複雑なワークフロー処理の記述が可能
- Flow Frameworkを利用しないと使えない（使うのが難しい）機能もあるため、まずは利用を検討

## AWS Direct Connect
- AWSとお客様設備の間に専用線を利用したプライベート接続を提供するサービス
- 帯域スループット向上
- インターネットベースの接続よりも一貫性がある
- ネットワークコスト削減
- インターネットVPN vs 専用線
    - VPN
        - 帯域:暗号化のオーバーヘッドにより制限あり
        - 品質 インターネットベースのため経路上のネットワーク状態の影響を受ける
- プライベート接続とパブリック接続
    - プライベート接続ではプライベートIPアドレスを使う
        - VGWへ設定が必要
    - パブリック接続では所有のグローバルIP or AWSから払い出されるグローバルIPアドレスを使用する
- オンプレミス拠点側ルータの要件
    - BGP対応であること
        – MD5認証対応
    - IEEE 802.1q VLANが利用できること
        – スイッチングハブでタグVLANを終端するなら必要なし
    - RFC 3021 (/31サブネット)対応であること
        – パブリック接続でAWSからパブリックIPアドレスを利用する場合のみ
- BGP(Border Gateway Protocol)
    - インターネット上でプロバイダ同士の相互接続において、お互いの経路情報をやり取りするために使われるルーティングプロトコルの一つです。

## Amazon Route 53
- AWSの提供する権威DNSサービス
- 高い可用性を提供
- マネージドサービスとして提供
- ALIASレコード
    - Route 53固有の仮想リソースレコード
    - – DNSクエリに対して、S3等のAWSサービスのエンドポイントのIPアドレスを直接返す(通常はCNAMEを利用)
    – DNSクエリに対するレスポンスが高速
    – Zone Apexが利用可能
    – ALIASレコードに対するクエリが無料

### トラフィックルーティング
– クライアントからのトラフィックを、要件に応じて適切な宛先へ転送すること
– ここでは、DNS名前解決によるトラフィックの転送を対象とする
– DNSクエリに対して適切な転送先を応答するために、ルーティングポリシーを活用する
– トラフィックルーティングを適切に設計することにより、可用性が高くレイテンシの少ないアーキテクチャを構築することができる

### ルーティングポリシー
Route 53では、複数のルーティングポリシーにより柔軟なルールを作成可能
-  シンプルルーティング (Simple)
    – レコードセットで事前に設定された値のみに基づいてDNSクエリに応答する
    – 従来のDNSと同様に、静的なマッピングによりルーティングが決定される
-  加重ルーティング (Weighted)
    – 複数エンドポイント毎に設定された重みづけに基づいて、DNSクエリに応答する
    – より重み付けの高いエンドポイントのリソースに、より多くルーティングされる
-  レイテンシールーティング (Latency)
    – AWSリージョンとの遅延によって、DNSクエリに応答する
    – リージョン間の遅延が少ない方のリソースへルーティングされる
-  フェイルオーバールーティング (Failover)
    – ヘルスチェックの結果に基づいて、利用可能なリソースをDNSクエリに応答する
    – 利用可能なリソースにのみルーティングされる
-  位置情報ルーティング (Geolocation)
    – クライアントの位置情報に基づいて、DNSクエリに応答する
    – 特定の地域・国からのDNSクエリに対して、特定のアドレスを応答する

### トラフィックフロー
– Route 53で、ポリシーベースのトラフィックルーティングを、ビジュアルに簡単に作成・管理できる機能
– 複雑なルーティングポリシーを組み合わせたルールを、抽象的なレベルで管理できる
– 特に、マルチリージョンアーキテクチャで、高可用性、低レイテンシーで、複雑なポリシーを適用する必要がある大規模システムの設計・運用でメリットが大きい

## AWS OpsWorks
- Chefを使⽤してアプリケーションを構成および運⽤するための構成管理サービス

### AWS OpsWorks スタック
- ライフサイクルイベントによるタスクの⾃動化が可能

### Chef Automate
- Chefのcookbookやレシピを使って、インフラストラクチャの管理を⾃動化

## Amazon Redshift
-フルマネージドなDWH特化の高速RDB
- MPP : Massive Parallel Processingo
    - １つのタスクを複数のノードで分散して実行する仕組み
- シェアードナッシング
    - ディスクをノードで共有しない構成
    - ディスクを共有する
- 列指向型（カラムナ）
- Redshiftに向くワークロード
    - 巨大なデータ・セット（数百GB～ペタバイト）
    - １つ１つのSQLが複雑だが、同時実行SQLは少ない
    - データの更新は一括導入
- ユースケース
    - データウェアハウス（DWH）
    - ユーザがクエリーを作成する（自由クエリー）（BI等）
- Redshiftには制約が存在しない
    - 制約やプライマリーキーの作成は可能。






